services:
  dock-otter:
    build: 
      context: .
      args:
        VERSION: "${VERSION:-1.0.0}"
        BUILD_TIME: "${BUILD_TIME:-}"
        GIT_COMMIT: "${GIT_COMMIT:-unknown}"
    container_name: dock-otter
    restart: unless-stopped
    env_file:
      - .env
    environment:
      # Override defaults if needed
      - DOKPLOY_URL=${DOKPLOY_URL:-http://dokploy:3000}
      - PANGOLIN_URL=${PANGOLIN_URL:-http://pangolin:3001}
      - POLL_INTERVAL=${POLL_INTERVAL:-30s}
      - RETRY_ATTEMPTS=${RETRY_ATTEMPTS:-3}
      - RETRY_DELAY=${RETRY_DELAY:-5s}
    networks:
      - shared-proxy
      - dokploy-network
      - pangolin
    # Optional: Mount logs directory
    volumes:
      - ./logs:/app/logs
    # Health check port (optional external access)
    ports:
      - "${HEALTH_PORT:-8080}:8080"
    # Health check is built into Dockerfile
    labels:
      - "com.docker.compose.project=dock-otter"
      - "maintainer=dock-otter-team"
      - "version=${VERSION:-1.0.0}"

# Use existing networks from your VPS setup
networks:
  shared-proxy:
    external: true
    name: ${SHARED_PROXY_NETWORK:-shared-proxy}
  dokploy-network:
    external: true
    name: ${DOKPLOY_NETWORK:-dokploy-network}
  pangolin:
    external: true
    name: ${PANGOLIN_NETWORK:-pangolin}